<%# Modern Product Card Component with Quick Actions %>

<div class="product-card group"
     data-controller="quick-view"
     data-quick-view-product-id-value="<%= item.id %>"
     data-quick-view-url-value="<%= item_path(item) %>">
  
  <%# Product Image %>
  <div class="product-card-image">
    <%= link_to item_path(item) do %>
      <% if item.images.any? %>
        <%= image_tag item.images.first.url, 
            alt: item.name,
            class: "absolute inset-0 w-full h-full object-cover" %>
      <% elsif item.image.attached? %>
        <%= image_tag item.image, 
            alt: item.name,
            class: "absolute inset-0 w-full h-full object-cover" %>
      <% else %>
        <div class="absolute inset-0 w-full h-full bg-gradient-to-br from-spirit-light to-spirit-primary/20 flex items-center justify-center">
          <svg class="w-20 h-20 text-spirit-primary/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
      <% end %>
    <% end %>
    
    <%# Badges %>
    <% if item.featured? %>
      <span class="badge-featured">
        âœ¨ Featured
      </span>
    <% elsif item.on_sale? %>
      <span class="badge-sale">
        <%= item.discount_percentage %>% OFF
      </span>
    <% elsif item.newly_listed? %>
      <span class="badge-new">
        ðŸ†• New
      </span>
    <% end %>
    
    <%# Quick Actions Overlay %>
    <div class="product-card-overlay">
      <div class="flex items-center space-x-2">
        <%# Quick View Button %>
        <button class="px-4 py-2 bg-white text-spirit-primary rounded-lg font-medium 
                     hover:bg-spirit-light transition-all duration-200 shadow-lg"
                data-action="click->quick-view#open">
          <svg class="inline w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>
          Quick View
        </button>
        
        <%# Add to Cart Button %>
        <button class="p-2 bg-white text-spirit-primary rounded-lg hover:bg-spirit-light 
                     transition-all duration-200 shadow-lg"
                data-action="click->enhanced-cart#addItem"
                data-product-id="<%= item.id %>"
                title="Add to Cart">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
  
  <%# Product Info %>
  <div class="p-4 space-y-3">
    
    <%# Title and Wishlist %>
    <div class="flex items-start justify-between">
      <%= link_to item_path(item), class: "flex-1 min-w-0" do %>
        <h3 class="font-semibold text-gray-900 truncate hover:text-spirit-primary transition-colors duration-200 group-hover:text-spirit-primary">
          <%= item.name %>
        </h3>
      <% end %>
      
      <%# Wishlist Heart %>
      <button class="p-1 hover:bg-spirit-light/50 rounded-full transition-colors flex-shrink-0"
              data-controller="wishlist-manager"
              data-wishlist-manager-product-id-value="<%= item.id %>"
              data-wishlist-manager-in-wishlist-value="<%= user_signed_in? && current_user.wishlisted?(item) %>"
              data-action="click->wishlist-manager#toggle">
        <svg class="w-5 h-5 <%= user_signed_in? && current_user.wishlisted?(item) ? 'text-red-500 fill-current' : 'text-gray-400' %>" 
             data-wishlist-manager-target="icon"
             fill="none" 
             stroke="currentColor" 
             viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
        </svg>
      </button>
    </div>
    
    <%# Category %>
    <% if item.categories.any? %>
      <div class="flex flex-wrap gap-1">
        <% item.categories.first(2).each do |category| %>
          <%= link_to category.name,
              items_path(filter_categories: [category.id]),
              class: "text-xs px-2 py-1 bg-spirit-light text-spirit-primary rounded-full hover:bg-spirit-primary hover:text-white transition-colors duration-200" %>
        <% end %>
      </div>
    <% end %>
    
    <%# Rating %>
    <% if item.reviews_count > 0 %>
      <div class="flex items-center space-x-2">
        <div class="flex text-yellow-400 text-sm">
          <% item.average_rating.to_i.times do %>â˜…<% end %>
          <% (5 - item.average_rating.to_i).times do %>â˜†<% end %>
        </div>
        <span class="text-xs text-gray-500">
          (<%= item.reviews_count %> <%= 'review'.pluralize(item.reviews_count) %>)
        </span>
      </div>
    <% else %>
      <div class="text-xs text-gray-400">No reviews yet</div>
    <% end %>
    
    <%# Price and Actions %>
    <div class="flex items-end justify-between pt-2 border-t border-gray-100">
      <div class="space-y-1">
        <div class="flex items-baseline space-x-2">
          <span class="text-2xl font-bold text-spirit-primary">
            <%= number_to_currency(item.price) %>
          </span>
          
          <% if item.original_price && item.original_price > item.price %>
            <span class="text-sm text-gray-400 line-through">
              <%= number_to_currency(item.original_price) %>
            </span>
          <% end %>
        </div>
        
        <%# Seller Info %>
        <div class="flex items-center space-x-1 text-xs text-gray-500">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
          <span><%= item.user.name %></span>
          <% if item.user.verified_seller? %>
            <svg class="w-3 h-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
          <% end %>
        </div>
      </div>
      
      <%# Compact Action Buttons %>
      <div class="flex flex-col space-y-1">
        <button class="p-2 bg-spirit-light hover:bg-spirit-primary hover:text-white text-spirit-primary rounded-lg transition-all duration-200"
                data-action="click->product-comparison#add"
                data-product-id="<%= item.id %>"
                data-product-name="<%= item.name %>"
                data-product-image="<%= item.image_url %>"
                data-product-price="<%= number_to_currency(item.price) %>"
                title="Compare">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
        </button>
      </div>
    </div>
    
    <%# Stock Status %>
    <% if item.stock_quantity.present? %>
      <div class="flex items-center space-x-2 text-xs">
        <% if item.stock_quantity > 10 %>
          <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          <span class="text-green-600 font-medium">In Stock</span>
        <% elsif item.stock_quantity > 0 %>
          <div class="w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></div>
          <span class="text-yellow-600 font-medium">Only <%= item.stock_quantity %> left!</span>
        <% else %>
          <div class="w-2 h-2 bg-red-500 rounded-full"></div>
          <span class="text-red-600 font-medium">Out of Stock</span>
        <% end %>
      </div>
    <% end %>
    
    <%# Shipping Info %>
    <% if item.free_shipping? %>
      <div class="flex items-center space-x-1 text-xs text-green-600">
        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
          <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
          <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z"/>
        </svg>
        <span class="font-medium">Free Shipping</span>
      </div>
    <% end %>
  </div>
  
  <%# Hover Effect Border %>
  <div class="absolute inset-0 rounded-xl border-2 border-transparent group-hover:border-spirit-primary transition-colors duration-300 pointer-events-none"></div>
</div>