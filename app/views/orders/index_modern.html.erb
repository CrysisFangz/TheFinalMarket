<%# app/views/orders/index_modern.html.erb %>
<%# Modern Order History with Advanced Filtering and Tracking %>

<div class="orders-container" data-controller="scroll-animation">
  <!-- Page Header -->
  <div class="page-header-modern" data-scroll-animation-target="animated">
    <div class="page-header-content">
      <div>
        <h1 class="page-title-modern">My Orders</h1>
        <p class="page-subtitle-modern">Track and manage all your purchases</p>
      </div>
      <div class="page-header-actions">
        <%= link_to root_path, class: "btn-secondary-modern" do %>
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
          </svg>
          Continue Shopping
        <% end %>
      </div>
    </div>
  </div>

  <% if @orders.any? %>
    <!-- Order Stats -->
    <div class="stats-grid" data-scroll-animation-target="animated">
      <div class="stat-card">
        <div class="stat-icon stat-icon-blue">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value"><%= @orders.count %></div>
          <div class="stat-label">Total Orders</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-green">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value"><%= @orders.where(status: :delivered).count %></div>
          <div class="stat-label">Delivered</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-orange">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
            <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value"><%= @orders.where(status: [:pending, :processing, :shipped]).count %></div>
          <div class="stat-label">In Transit</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon stat-icon-purple">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">$<%= number_with_precision(@orders.sum(:total_amount), precision: 2) %></div>
          <div class="stat-label">Total Spent</div>
        </div>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar-modern" data-scroll-animation-target="animated">
      <div class="filter-tabs">
        <button class="filter-tab active" data-filter="all">
          All Orders
          <span class="filter-badge"><%= @orders.count %></span>
        </button>
        <button class="filter-tab" data-filter="pending">
          Processing
          <span class="filter-badge"><%= @orders.where(status: [:pending, :processing]).count %></span>
        </button>
        <button class="filter-tab" data-filter="shipped">
          Shipped
          <span class="filter-badge"><%= @orders.where(status: :shipped).count %></span>
        </button>
        <button class="filter-tab" data-filter="delivered">
          Delivered
          <span class="filter-badge"><%= @orders.where(status: :delivered).count %></span>
        </button>
      </div>

      <div class="filter-search">
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <input type="search" 
               class="search-input" 
               placeholder="Search orders by ID or product name...">
      </div>
    </div>

    <!-- Orders List -->
    <div class="orders-list">
      <% @orders.each_with_index do |order, index| %>
        <div class="order-card-modern" 
             data-scroll-animation-target="animated"
             data-order-status="<%= order.status %>"
             style="animation-delay: <%= index * 0.1 %>s;">
          
          <!-- Order Header -->
          <div class="order-card-header">
            <div class="order-header-left">
              <div class="order-id">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                  <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                </svg>
                Order #<%= order.id %>
              </div>
              <div class="order-date">
                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                </svg>
                <%= order.created_at.strftime("%b %d, %Y") %>
              </div>
            </div>

            <div class="order-header-right">
              <span class="status-badge status-<%= order.status %>">
                <%= order.status.titleize %>
              </span>
              <div class="order-total">
                $<%= number_with_precision(order.total_amount, precision: 2) %>
              </div>
            </div>
          </div>

          <!-- Order Progress Bar (for in-transit orders) -->
          <% if order.status.in?(["processing", "shipped"]) %>
            <div class="order-progress">
              <div class="progress-steps-horizontal">
                <div class="progress-step-h <%= 'completed' if order.status.in?(["processing", "shipped", "delivered"]) %>">
                  <div class="progress-dot-h"></div>
                  <span class="progress-label-h">Order Placed</span>
                </div>
                <div class="progress-line-h <%= 'active' if order.status.in?(["shipped", "delivered"]) %>"></div>
                <div class="progress-step-h <%= 'completed' if order.status.in?(["shipped", "delivered"]) %> <%= 'active' if order.status == 'processing' %>">
                  <div class="progress-dot-h"></div>
                  <span class="progress-label-h">Processing</span>
                </div>
                <div class="progress-line-h <%= 'active' if order.status == 'delivered' %>"></div>
                <div class="progress-step-h <%= 'completed' if order.status == 'delivered' %> <%= 'active' if order.status == 'shipped' %>">
                  <div class="progress-dot-h"></div>
                  <span class="progress-label-h">Shipped</span>
                </div>
                <div class="progress-line-h"></div>
                <div class="progress-step-h">
                  <div class="progress-dot-h"></div>
                  <span class="progress-label-h">Delivered</span>
                </div>
              </div>
            </div>
          <% end %>

          <!-- Order Items -->
          <div class="order-items-preview">
            <% order.order_items.limit(3).each do |order_item| %>
              <div class="order-item-preview">
                <% if order_item.item.images.attached? %>
                  <%= image_tag order_item.item.images.first.variant(resize_to_limit: [80, 80]),
                      class: "order-item-image" %>
                <% else %>
                  <div class="order-item-image-placeholder">
                    <svg fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                    </svg>
                  </div>
                <% end %>
                <div class="order-item-details">
                  <div class="order-item-name"><%= order_item.item.name %></div>
                  <div class="order-item-meta">
                    Qty: <%= order_item.quantity %> Ã— $<%= number_with_precision(order_item.unit_price, precision: 2) %>
                  </div>
                </div>
                <div class="order-item-subtotal">
                  $<%= number_with_precision(order_item.subtotal, precision: 2) %>
                </div>
              </div>
            <% end %>
            
            <% if order.order_items.count > 3 %>
              <div class="order-items-more">
                + <%= order.order_items.count - 3 %> more items
              </div>
            <% end %>
          </div>

          <!-- Order Actions -->
          <div class="order-card-actions">
            <%= link_to order_path(order), class: "btn-secondary-modern" do %>
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
              View Details
            <% end %>

            <% if order.tracking_number.present? %>
              <button class="btn-primary-modern">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                Track Package
              </button>
            <% end %>

            <% if order.delivered? && !order.review %>
              <%= link_to "#", class: "btn-success-modern" do %>
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                </svg>
                Write Review
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

  <% else %>
    <!-- Empty State -->
    <div class="empty-state-modern" data-scroll-animation-target="animated">
      <div class="empty-state-icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
      </div>
      <h3 class="empty-state-title">No Orders Yet</h3>
      <p class="empty-state-text">
        You haven't placed any orders yet. Start shopping and discover amazing products!
      </p>
      <%= link_to root_path, class: "btn-primary-modern btn-lg" do %>
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
        </svg>
        Start Shopping
      <% end %>
    </div>
  <% end %>
</div>

<style>
  /* Orders Page Styles */
  .orders-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-md);
  }

  .stat-icon {
    width: 56px;
    height: 56px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .stat-icon svg {
    width: 28px;
    height: 28px;
    color: white;
  }

  .stat-icon-blue {
    background: linear-gradient(135deg, var(--primary-light), var(--primary));
  }

  .stat-icon-green {
    background: linear-gradient(135deg, #10B981, #059669);
  }

  .stat-icon-orange {
    background: linear-gradient(135deg, #F59E0B, #D97706);
  }

  .stat-icon-purple {
    background: linear-gradient(135deg, #8B5CF6, #7C3AED);
  }

  .stat-content {
    flex: 1;
  }

  .stat-value {
    font-size: 1.875rem;
    font-weight: 800;
    color: var(--gray-900);
    line-height: 1;
  }

  .stat-label {
    font-size: 0.875rem;
    color: var(--gray-600);
    margin-top: 0.25rem;
  }

  .filter-bar-modern {
    background: white;
    padding: 1.5rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    margin-bottom: 2rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .filter-tabs {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    flex: 1;
  }

  .filter-tab {
    padding: 0.625rem 1rem;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-700);
    background: var(--gray-100);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .filter-tab:hover {
    background: var(--gray-200);
  }

  .filter-tab.active {
    background: var(--primary);
    color: white;
  }

  .filter-badge {
    background: rgba(0, 0, 0, 0.1);
    padding: 0.125rem 0.5rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 700;
  }

  .filter-search {
    position: relative;
    min-width: 300px;
  }

  .search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    color: var(--gray-400);
  }

  .search-input {
    width: 100%;
    padding: 0.625rem 1rem 0.625rem 3rem;
    border: 2px solid var(--gray-300);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    transition: all 0.3s ease;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
  }

  .orders-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .order-card-modern {
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .order-card-modern:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .order-card-header {
    padding: 1.5rem;
    background: var(--gray-50);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--gray-200);
  }

  .order-header-left {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .order-id {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--gray-900);
    display: flex;
    align-items: center;
  }

  .order-date {
    font-size: 0.875rem;
    color: var(--gray-600);
    display: flex;
    align-items: center;
  }

  .order-header-right {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .order-total {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary);
  }

  .status-badge {
    padding: 0.5rem 1rem;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .status-pending,
  .status-processing {
    background: rgba(59, 130, 246, 0.1);
    color: #1E40AF;
  }

  .status-shipped {
    background: rgba(245, 158, 11, 0.1);
    color: #B45309;
  }

  .status-delivered,
  .status-completed {
    background: rgba(16, 185, 129, 0.1);
    color: #065F46;
  }

  .status-cancelled,
  .status-refunded {
    background: rgba(239, 68, 68, 0.1);
    color: #991B1B;
  }

  .order-progress {
    padding: 1.5rem;
    background: linear-gradient(to bottom, var(--gray-50), white);
  }

  .progress-steps-horizontal {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .progress-step-h {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }

  .progress-dot-h {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--gray-300);
    border: 3px solid white;
    box-shadow: 0 0 0 2px var(--gray-300);
    transition: all 0.3s ease;
  }

  .progress-step-h.active .progress-dot-h {
    background: var(--primary);
    box-shadow: 0 0 0 2px var(--primary), 0 0 0 6px rgba(var(--primary-rgb), 0.2);
    animation: pulse-ring 2s ease-in-out infinite;
  }

  .progress-step-h.completed .progress-dot-h {
    background: var(--success);
    box-shadow: 0 0 0 2px var(--success);
  }

  .progress-label-h {
    font-size: 0.75rem;
    color: var(--gray-600);
    margin-top: 0.5rem;
    text-align: center;
  }

  .progress-line-h {
    flex: 1;
    height: 2px;
    background: var(--gray-300);
    margin: 0 0.5rem;
    transition: all 0.3s ease;
  }

  .progress-line-h.active {
    background: var(--primary);
  }

  .order-items-preview {
    padding: 1.5rem;
  }

  .order-item-preview {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--gray-200);
  }

  .order-item-preview:last-child {
    border-bottom: none;
  }

  .order-item-image {
    width: 64px;
    height: 64px;
    object-fit: cover;
    border-radius: var(--radius-md);
    flex-shrink: 0;
  }

  .order-item-image-placeholder {
    width: 64px;
    height: 64px;
    background: var(--gray-100);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .order-item-image-placeholder svg {
    width: 32px;
    height: 32px;
    color: var(--gray-400);
  }

  .order-item-details {
    flex: 1;
  }

  .order-item-name {
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 0.25rem;
  }

  .order-item-meta {
    font-size: 0.875rem;
    color: var(--gray-600);
  }

  .order-item-subtotal {
    font-weight: 700;
    color: var(--gray-900);
  }

  .order-items-more {
    text-align: center;
    padding: 1rem;
    color: var(--primary);
    font-size: 0.875rem;
    font-weight: 600;
  }

  .order-card-actions {
    display: flex;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--gray-50);
    border-top: 1px solid var(--gray-200);
  }

  @keyframes pulse-ring {
    0%, 100% {
      box-shadow: 0 0 0 2px var(--primary), 0 0 0 6px rgba(var(--primary-rgb), 0.2);
    }
    50% {
      box-shadow: 0 0 0 2px var(--primary), 0 0 0 10px rgba(var(--primary-rgb), 0);
    }
  }

  @media (max-width: 768px) {
    .filter-bar-modern {
      flex-direction: column;
    }

    .filter-search {
      min-width: 100%;
    }

    .order-card-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .order-header-right {
      width: 100%;
      justify-content: space-between;
    }

    .order-card-actions {
      flex-direction: column;
    }

    .progress-label-h {
      font-size: 0.625rem;
    }
  }
</style>