<%# app/views/orders/new_modern.html.erb %>
<%# Modern Multi-Step Checkout Experience %>

<div class="checkout-modern" data-controller="checkout" data-checkout-step-value="1" data-checkout-total-steps-value="3">
  <!-- Progress Bar -->
  <div class="checkout-progress-container">
    <div class="checkout-progress-wrapper">
      <div class="checkout-progress-steps">
        <div class="progress-step" data-checkout-target="progressStep" data-step="1" data-action="click->checkout#goToStep">
          <div class="step-circle">
            <span class="step-number">1</span>
            <svg class="step-check hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
          <span class="step-label">Shipping</span>
        </div>

        <div class="progress-line"></div>

        <div class="progress-step" data-checkout-target="progressStep" data-step="2" data-action="click->checkout#goToStep">
          <div class="step-circle">
            <span class="step-number">2</span>
            <svg class="step-check hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
          <span class="step-label">Payment</span>
        </div>

        <div class="progress-line"></div>

        <div class="progress-step" data-checkout-target="progressStep" data-step="3" data-action="click->checkout#goToStep">
          <div class="step-circle">
            <span class="step-number">3</span>
            <svg class="step-check hidden" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
          <span class="step-label">Review</span>
        </div>
      </div>

      <div class="progress-bar-track">
        <div class="progress-bar-fill" data-checkout-target="progressBar"></div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="checkout-content-grid">
    <!-- Steps Column -->
    <div class="checkout-steps-column">
      
      <!-- Step 1: Shipping Information -->
      <div class="checkout-step" data-checkout-target="step">
        <div class="card-modern">
          <div class="card-header-modern">
            <div class="flex items-center">
              <div class="step-icon">
                <svg fill="currentColor" viewBox="0 0 20 20">
                  <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
                  <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z"/>
                </svg>
              </div>
              <div>
                <h2 class="card-title">Shipping Information</h2>
                <p class="text-sm text-gray-500 mt-1">Where should we deliver your order?</p>
              </div>
            </div>
          </div>

          <div class="card-body-modern" data-checkout-target="shippingForm">
            <%= form_with(model: @order, url: orders_path, method: :post, local: true, html: { class: "form-modern" }) do |f| %>
              <div class="form-grid-2col">
                <div class="form-group-modern">
                  <%= f.label :full_name, "Full Name", class: "form-label-modern" %>
                  <%= f.text_field :full_name, 
                      class: "form-input-modern",
                      placeholder: "John Doe",
                      required: true,
                      data: { action: "blur->checkout#validateShipping" } %>
                </div>

                <div class="form-group-modern">
                  <%= f.label :phone, "Phone Number", class: "form-label-modern" %>
                  <%= f.telephone_field :phone,
                      class: "form-input-modern",
                      placeholder: "(555) 123-4567",
                      required: true,
                      data: { action: "blur->checkout#validateShipping" } %>
                </div>
              </div>

              <div class="form-group-modern">
                <%= f.label :address_line1, "Street Address", class: "form-label-modern" %>
                <%= f.text_field :address_line1,
                    class: "form-input-modern",
                    placeholder: "123 Main St",
                    required: true,
                    data: { action: "blur->checkout#validateShipping" } %>
              </div>

              <div class="form-group-modern">
                <%= f.label :address_line2, "Apt, Suite, etc. (Optional)", class: "form-label-modern" %>
                <%= f.text_field :address_line2,
                    class: "form-input-modern",
                    placeholder: "Apartment 4B" %>
              </div>

              <div class="form-grid-3col">
                <div class="form-group-modern">
                  <%= f.label :city, "City", class: "form-label-modern" %>
                  <%= f.text_field :city,
                      class: "form-input-modern",
                      placeholder: "New York",
                      required: true,
                      data: { action: "blur->checkout#validateShipping" } %>
                </div>

                <div class="form-group-modern">
                  <%= f.label :state, "State", class: "form-label-modern" %>
                  <%= f.select :state,
                      options_for_select(["AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"]),
                      { prompt: "Select" },
                      { class: "form-select-modern", required: true } %>
                </div>

                <div class="form-group-modern">
                  <%= f.label :zip_code, "ZIP Code", class: "form-label-modern" %>
                  <%= f.text_field :zip_code,
                      class: "form-input-modern",
                      placeholder: "10001",
                      maxlength: 5,
                      required: true,
                      data: { action: "blur->checkout#validateShipping" } %>
                </div>
              </div>

              <div class="form-group-modern">
                <%= f.label :notes, "Delivery Instructions (Optional)", class: "form-label-modern" %>
                <%= f.text_area :notes,
                    rows: 3,
                    class: "form-textarea-modern",
                    placeholder: "Leave package at front door, ring doorbell twice..." %>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Step 2: Payment Information -->
      <div class="checkout-step hidden" data-checkout-target="step">
        <div class="card-modern">
          <div class="card-header-modern">
            <div class="flex items-center">
              <div class="step-icon">
                <svg fill="currentColor" viewBox="0 0 20 20">
                  <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                  <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div>
                <h2 class="card-title">Payment Method</h2>
                <p class="text-sm text-gray-500 mt-1">All transactions are secure and encrypted</p>
              </div>
            </div>
          </div>

          <div class="card-body-modern" data-checkout-target="paymentForm">
            <div class="payment-method-selector">
              <label class="payment-option">
                <input type="radio" name="payment_method" value="credit_card" checked class="sr-only">
                <div class="payment-option-card">
                  <div class="flex items-center">
                    <svg class="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                    </svg>
                    <div>
                      <div class="font-semibold">Credit / Debit Card</div>
                      <div class="text-sm text-gray-500">Visa, Mastercard, Amex</div>
                    </div>
                  </div>
                  <div class="check-circle">
                    <svg fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                  </div>
                </div>
              </label>

              <label class="payment-option">
                <input type="radio" name="payment_method" value="paypal" class="sr-only">
                <div class="payment-option-card">
                  <div class="flex items-center">
                    <svg class="w-8 h-8 mr-3" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M20.067 8.478c.492.88.556 2.014.3 3.327-.74 3.806-3.276 5.12-6.514 5.12h-.5a.805.805 0 00-.794.68l-.04.22-.63 3.993-.028.147a.8.8 0 01-.792.68h-2.49a.622.622 0 01-.614-.714l1.578-10.003a.968.968 0 01.955-.817h2.994c1.92 0 3.24.4 4.076 1.367z"/>
                      <path d="M6.956 6.956C8.195 5.616 10.04 5 12.524 5h6.406c.756 0 1.376.612 1.376 1.368v.647c0 3.143-1.063 5.258-3.143 6.39C18.376 13.895 19 15.084 19 16.568V17c0 .756-.62 1.376-1.376 1.376h-6.404c-2.485 0-4.328-.616-5.568-1.955C4.446 15.09 4 13.268 4 10.994V8.332c0-.756.612-1.376 1.376-1.376h.58z"/>
                    </svg>
                    <div>
                      <div class="font-semibold">PayPal</div>
                      <div class="text-sm text-gray-500">Fast & secure</div>
                    </div>
                  </div>
                  <div class="check-circle">
                    <svg fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                  </div>
                </div>
              </label>
            </div>

            <div class="mt-6 space-y-4">
              <div class="form-group-modern">
                <label class="form-label-modern">Card Number</label>
                <input type="text" 
                       class="form-input-modern" 
                       placeholder="1234 5678 9012 3456"
                       maxlength="19"
                       required>
              </div>

              <div class="form-group-modern">
                <label class="form-label-modern">Cardholder Name</label>
                <input type="text" 
                       class="form-input-modern" 
                       placeholder="John Doe"
                       required>
              </div>

              <div class="form-grid-2col">
                <div class="form-group-modern">
                  <label class="form-label-modern">Expiry Date</label>
                  <input type="text" 
                         class="form-input-modern" 
                         placeholder="MM/YY"
                         maxlength="5"
                         required>
                </div>

                <div class="form-group-modern">
                  <label class="form-label-modern">CVV</label>
                  <input type="text" 
                         class="form-input-modern" 
                         placeholder="123"
                         maxlength="4"
                         required>
                </div>
              </div>

              <div class="security-badge">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>Your payment information is encrypted and secure</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Review Order -->
      <div class="checkout-step hidden" data-checkout-target="step">
        <div class="card-modern">
          <div class="card-header-modern">
            <div class="flex items-center">
              <div class="step-icon">
                <svg fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
              </div>
              <div>
                <h2 class="card-title">Review Your Order</h2>
                <p class="text-sm text-gray-500 mt-1">Please review your order before placing it</p>
              </div>
            </div>
          </div>

          <div class="card-body-modern" data-checkout-target="reviewForm">
            <!-- Shipping Address Review -->
            <div class="review-section">
              <div class="review-section-header">
                <h3 class="review-section-title">Shipping Address</h3>
                <button type="button" 
                        class="btn-link"
                        data-action="click->checkout#goToStep"
                        data-step="1">
                  Edit
                </button>
              </div>
              <div class="review-section-content" data-checkout-target="shippingAddress">
                <!-- Will be populated by controller -->
              </div>
            </div>

            <!-- Payment Method Review -->
            <div class="review-section">
              <div class="review-section-header">
                <h3 class="review-section-title">Payment Method</h3>
                <button type="button" 
                        class="btn-link"
                        data-action="click->checkout#goToStep"
                        data-step="2">
                  Edit
                </button>
              </div>
              <div class="review-section-content" data-checkout-target="paymentMethod">
                <div class="flex items-center">
                  <svg class="w-10 h-10 mr-3 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                  </svg>
                  <div>
                    <div class="font-medium">Visa •••• 4242</div>
                    <div class="text-sm text-gray-500">Expires 12/25</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Order Items Review -->
            <div class="review-section">
              <div class="review-section-header">
                <h3 class="review-section-title">Order Items (<%= @cart_items.sum(&:quantity) %>)</h3>
              </div>
              <div class="review-section-content">
                <div class="space-y-4">
                  <% @cart_items.each do |cart_item| %>
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">
                        <% if cart_item.item.images.attached? %>
                          <%= image_tag cart_item.item.images.first.variant(resize_to_limit: [80, 80]),
                              class: "w-16 h-16 rounded-lg object-cover mr-4" %>
                        <% end %>
                        <div>
                          <div class="font-medium"><%= cart_item.item.name %></div>
                          <div class="text-sm text-gray-500">Qty: <%= cart_item.quantity %></div>
                        </div>
                      </div>
                      <div class="font-semibold">
                        $<%= number_with_precision(cart_item.subtotal, precision: 2) %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>

            <!-- Terms & Conditions -->
            <div class="form-group-modern mt-6">
              <label class="checkbox-container">
                <input type="checkbox" required class="form-checkbox">
                <span class="checkbox-label">
                  I agree to the <a href="#" class="text-primary hover:underline">Terms & Conditions</a> 
                  and <a href="#" class="text-primary hover:underline">Privacy Policy</a>
                </span>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Summary Sidebar -->
    <div class="checkout-summary-column">
      <div class="card-modern sticky top-4">
        <div class="card-header-modern">
          <h3 class="card-title">Order Summary</h3>
        </div>

        <div class="card-body-modern">
          <div class="space-y-3">
            <div class="summary-row">
              <span class="summary-label">Subtotal</span>
              <span class="summary-value">$<%= number_with_precision(@total, precision: 2) %></span>
            </div>

            <div class="summary-row">
              <span class="summary-label">Shipping</span>
              <span class="summary-value text-success">FREE</span>
            </div>

            <div class="summary-row">
              <span class="summary-label">Tax</span>
              <span class="summary-value">$<%= number_with_precision(@total * 0.08, precision: 2) %></span>
            </div>

            <div class="divider-modern"></div>

            <div class="summary-row-total">
              <span class="summary-label-total">Total</span>
              <span class="summary-value-total">$<%= number_with_precision(@total * 1.08, precision: 2) %></span>
            </div>
          </div>

          <!-- Promo Code -->
          <div class="mt-6">
            <button type="button" class="btn-secondary-modern w-full" onclick="this.nextElementSibling.classList.toggle('hidden')">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clip-rule="evenodd"/>
              </svg>
              Have a promo code?
            </button>
            <div class="hidden mt-3">
              <div class="flex gap-2">
                <input type="text" class="form-input-modern flex-1" placeholder="Enter code">
                <button type="button" class="btn-primary-modern">Apply</button>
              </div>
            </div>
          </div>

          <!-- Security Badge -->
          <div class="security-info mt-6">
            <svg class="w-5 h-5 text-success" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
            </svg>
            <div>
              <div class="security-info-title">Secure Checkout</div>
              <div class="security-info-text">SSL encrypted payment</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Buttons -->
  <div class="checkout-navigation">
    <button type="button" 
            class="btn-secondary-modern hidden"
            data-checkout-target="prevButton"
            data-action="click->checkout#prevStep">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Previous Step
    </button>

    <button type="button" 
            class="btn-primary-modern"
            data-checkout-target="nextButton"
            data-action="click->checkout#nextStep">
      Next Step
      <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>

    <button type="submit" 
            class="btn-primary-modern hidden"
            data-checkout-target="submitButton"
            data-action="click->checkout#submitOrder">
      <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
      </svg>
      Place Order
    </button>
  </div>
</div>

<style>
  /* Checkout-specific styles */
  .checkout-modern {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .checkout-progress-container {
    background: white;
    padding: 2rem;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    margin-bottom: 2rem;
  }

  .checkout-progress-wrapper {
    max-width: 800px;
    margin: 0 auto;
  }

  .checkout-progress-steps {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    position: relative;
  }

  .progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1;
  }

  .step-circle {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--gray-200);
    border: 3px solid var(--gray-300);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: var(--gray-600);
    transition: all 0.3s ease;
    position: relative;
  }

  .step-number {
    font-size: 1.125rem;
  }

  .step-check {
    width: 24px;
    height: 24px;
    display: none;
  }

  .progress-step.step-current .step-circle {
    background: var(--primary);
    border-color: var(--primary-dark);
    color: white;
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
  }

  .progress-step.step-completed .step-circle {
    background: var(--success);
    border-color: var(--success-dark);
    color: white;
  }

  .progress-step.step-completed .step-number {
    display: none;
  }

  .progress-step.step-completed .step-check {
    display: block;
  }

  .step-label {
    margin-top: 0.75rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--gray-600);
    transition: color 0.3s ease;
  }

  .progress-step.step-current .step-label {
    color: var(--primary);
  }

  .progress-line {
    position: absolute;
    top: 24px;
    height: 3px;
    background: var(--gray-300);
    z-index: 0;
  }

  .progress-line:first-of-type {
    left: calc(16.66% + 24px);
    width: calc(33.33% - 48px);
  }

  .progress-line:last-of-type {
    left: calc(50% + 24px);
    width: calc(33.33% - 48px);
  }

  .progress-bar-track {
    width: 100%;
    height: 8px;
    background: var(--gray-200);
    border-radius: 4px;
    overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--primary-light));
    width: 33.33%;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .checkout-content-grid {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .checkout-steps-column {
    min-height: 400px;
  }

  .checkout-summary-column {
  }

  .step-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background: linear-gradient(135deg, var(--primary-light), var(--primary));
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
  }

  .step-icon svg {
    width: 24px;
    height: 24px;
  }

  .payment-method-selector {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .payment-option {
    display: block;
    cursor: pointer;
  }

  .payment-option-card {
    padding: 1.5rem;
    border: 2px solid var(--gray-300);
    border-radius: var(--radius-lg);
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
  }

  .payment-option input:checked + .payment-option-card {
    border-color: var(--primary);
    background: rgba(var(--primary-rgb), 0.05);
  }

  .check-circle {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 2px solid var(--gray-400);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .check-circle svg {
    width: 16px;
    height: 16px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .payment-option input:checked + .payment-option-card .check-circle {
    background: var(--primary);
    border-color: var(--primary);
  }

  .payment-option input:checked + .payment-option-card .check-circle svg {
    opacity: 1;
    color: white;
  }

  .security-badge {
    display: flex;
    align-items: center;
    padding: 1rem;
    background: rgba(var(--success-rgb), 0.1);
    border: 1px solid rgba(var(--success-rgb), 0.3);
    border-radius: var(--radius-md);
    color: var(--success-dark);
    font-size: 0.875rem;
    gap: 0.75rem;
  }

  .review-section {
    padding: 1.5rem;
    background: var(--gray-50);
    border-radius: var(--radius-lg);
    margin-bottom: 1.5rem;
  }

  .review-section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .review-section-title {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--gray-900);
  }

  .review-section-content {
    color: var(--gray-700);
    line-height: 1.6;
  }

  .summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.875rem;
  }

  .summary-label {
    color: var(--gray-600);
  }

  .summary-value {
    color: var(--gray-900);
    font-weight: 600;
  }

  .summary-row-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
  }

  .summary-label-total {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--gray-900);
  }

  .summary-value-total {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary);
  }

  .security-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: rgba(var(--success-rgb), 0.05);
    border-radius: var(--radius-md);
  }

  .security-info-title {
    font-weight: 600;
    color: var(--success-dark);
    font-size: 0.875rem;
  }

  .security-info-text {
    font-size: 0.75rem;
    color: var(--gray-600);
  }

  .checkout-navigation {
    display: flex;
    justify-content: space-between;
    padding: 2rem;
    background: white;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
  }

  .checkbox-container {
    display: flex;
    align-items: start;
    cursor: pointer;
  }

  .form-checkbox {
    width: 18px;
    height: 18px;
    margin-right: 0.75rem;
    margin-top: 0.125rem;
    border-radius: 4px;
    border: 2px solid var(--gray-400);
    cursor: pointer;
  }

  .checkbox-label {
    font-size: 0.875rem;
    color: var(--gray-700);
    line-height: 1.5;
  }

  @media (max-width: 1024px) {
    .checkout-content-grid {
      grid-template-columns: 1fr;
    }

    .checkout-summary-column {
      order: -1;
    }
  }

  @media (max-width: 640px) {
    .checkout-progress-steps {
      flex-direction: row;
    }

    .step-label {
      font-size: 0.75rem;
    }

    .step-circle {
      width: 40px;
      height: 40px;
    }
  }
</style>