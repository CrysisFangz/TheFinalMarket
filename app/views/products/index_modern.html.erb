<%# Modern Enhanced Product Index Page %>
<div class="min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50">
  <%# Hero Section with Search %>
  <div class="relative overflow-hidden bg-gradient-to-r from-purple-600 via-pink-500 to-red-500 text-white">
    <div class="absolute inset-0 bg-black opacity-10"></div>
    
    <%# Decorative Elements %>
    <div class="absolute top-0 left-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-x-1/2 -translate-y-1/2 blur-3xl"></div>
    <div class="absolute bottom-0 right-0 w-96 h-96 bg-white opacity-5 rounded-full translate-x-1/2 translate-y-1/2 blur-3xl"></div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
      <div class="text-center scroll-fade-in">
        <h1 class="text-5xl md:text-6xl font-extrabold mb-6 tracking-tight">
          Discover Amazing Products
        </h1>
        <p class="text-xl md:text-2xl mb-8 text-white/90 max-w-2xl mx-auto">
          Explore thousands of curated items from trusted sellers worldwide
        </p>
        
        <%# Enhanced Search Bar %>
        <div class="max-w-3xl mx-auto" data-controller="live-search">
          <div class="search-modern">
            <%= form_with url: products_path, method: :get, 
                class: "relative",
                data: { 
                  turbo_frame: "search_results",
                  live_search_target: "form",
                  action: "submit->live-search#search"
                } do |f| %>
              
              <svg class="search-icon w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              
              <%= f.text_field :query,
                  class: "search-input text-gray-800",
                  placeholder: "Search for products, brands, or categories...",
                  value: params[:query],
                  autocomplete: "off",
                  data: {
                    live_search_target: "input",
                    action: "input->live-search#search"
                  } %>
              
              <div class="search-results" data-live-search-target="results"></div>
            <% end %>
          </div>
        </div>
        
        <%# Quick Category Pills %>
        <div class="flex flex-wrap justify-center gap-3 mt-8">
          <% ["Electronics", "Fashion", "Home", "Sports", "Books"].each do |category| %>
            <%= link_to category, products_path(category: category.downcase), 
                class: "badge badge-outline bg-white/20 hover:bg-white/30 text-white border-white/50 px-6 py-2 text-sm backdrop-blur-sm transition-all hover:scale-105" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <%# Filter and Sort Bar %>
  <div class="bg-white border-b border-gray-200 sticky top-0 z-30 backdrop-blur-xl bg-white/80">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        
        <%# Filter Section %>
        <div class="flex flex-wrap items-center gap-3">
          <span class="text-sm font-semibold text-gray-600">Filters:</span>
          
          <%= form_with url: products_path, method: :get, class: "flex flex-wrap items-center gap-3", data: { turbo: true } do |f| %>
            
            <%# Price Range %>
            <select name="price_range" 
                    class="input-modern text-sm py-2 px-3 rounded-full border-2"
                    data-action="change->form#submit">
              <option value="">All Prices</option>
              <option value="0-50" <%= 'selected' if params[:price_range] == '0-50' %>>Under $50</option>
              <option value="50-100" <%= 'selected' if params[:price_range] == '50-100' %>>$50 - $100</option>
              <option value="100-200" <%= 'selected' if params[:price_range] == '100-200' %>>$100 - $200</option>
              <option value="200+" <%= 'selected' if params[:price_range] == '200+' %>>$200+</option>
            </select>
            
            <%# Rating Filter %>
            <select name="rating" 
                    class="input-modern text-sm py-2 px-3 rounded-full border-2"
                    data-action="change->form#submit">
              <option value="">All Ratings</option>
              <option value="4" <%= 'selected' if params[:rating] == '4' %>>4★ & above</option>
              <option value="3" <%= 'selected' if params[:rating] == '3' %>>3★ & above</option>
            </select>
            
            <%# Condition %>
            <select name="condition" 
                    class="input-modern text-sm py-2 px-3 rounded-full border-2"
                    data-action="change->form#submit">
              <option value="">All Conditions</option>
              <option value="new" <%= 'selected' if params[:condition] == 'new' %>>New</option>
              <option value="like_new" <%= 'selected' if params[:condition] == 'like_new' %>>Like New</option>
              <option value="good" <%= 'selected' if params[:condition] == 'good' %>>Good</option>
            </select>
            
            <% if params.values.any?(&:present?) %>
              <%= link_to "Clear All", products_path, class: "btn-ghost py-2 px-4 text-sm rounded-full" %>
            <% end %>
          <% end %>
        </div>
        
        <%# Sort Section %>
        <div class="flex items-center gap-3">
          <span class="text-sm font-semibold text-gray-600">Sort:</span>
          <%= form_with url: products_path, method: :get, class: "flex items-center gap-2" do |f| %>
            <select name="sort" 
                    class="input-modern text-sm py-2 px-3 rounded-full border-2"
                    data-action="change->form#submit">
              <option value="newest" <%= 'selected' if params[:sort] == 'newest' %>>Newest</option>
              <option value="price_low" <%= 'selected' if params[:sort] == 'price_low' %>>Price: Low to High</option>
              <option value="price_high" <%= 'selected' if params[:sort] == 'price_high' %>>Price: High to Low</option>
              <option value="popular" <%= 'selected' if params[:sort] == 'popular' %>>Most Popular</option>
              <option value="rating" <%= 'selected' if params[:sort] == 'rating' %>>Highest Rated</option>
            </select>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <%# Main Content Area %>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <%# Results Summary %>
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-gray-900">
        <%= @products.total_count rescue @products.length %> Products Found
      </h2>
      
      <% if user_signed_in? && current_user.seller? %>
        <%= link_to new_product_path, class: "btn-primary flex items-center gap-2" do %>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <span>List New Product</span>
        <% end %>
      <% end %>
    </div>

    <%# Product Grid %>
    <% if @products.any? %>
      <div class="product-grid" data-controller="scroll-animation">
        <% @products.each_with_index do |product, index| %>
          <div class="product-card scroll-fade-in" 
               data-scroll-animation-target="element"
               style="transition-delay: <%= index * 0.05 %>s">
            
            <%# Product Image %>
            <div class="product-card-image">
              <%= link_to product_path(product) do %>
                <% if product.images&.first&.attached? %>
                  <%= image_tag product.images.first.variant(resize_to_limit: [600, 450]), 
                      alt: product.name,
                      loading: "lazy",
                      class: "w-full h-full object-cover" %>
                <% else %>
                  <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                    <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                  </div>
                <% end %>
              <% end %>
              
              <div class="product-card-overlay"></div>
              
              <%# Quick Action Buttons %>
              <div class="product-card-actions">
                <%= button_to wishlist_add_item_path(product_id: product.id), 
                    method: :post,
                    class: "action-button",
                    data: { turbo: false },
                    title: "Add to Wishlist" do %>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                  </svg>
                <% end %>
                
                <button class="action-button" 
                        data-action="click->quick-view#open"
                        data-product-id="<%= product.id %>"
                        title="Quick View">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </button>
              </div>
              
              <%# Badges %>
              <div class="absolute top-4 left-4 flex flex-col gap-2">
                <% if product.created_at > 7.days.ago %>
                  <span class="badge badge-gradient text-white">NEW</span>
                <% end %>
                
                <% if product.discount_percentage.present? && product.discount_percentage > 0 %>
                  <span class="badge bg-red-500 text-white">-<%= product.discount_percentage %>%</span>
                <% end %>
                
                <% if product.featured? %>
                  <span class="badge bg-amber-500 text-white">⭐ Featured</span>
                <% end %>
              </div>
            </div>

            <%# Product Info %>
            <div class="p-5">
              <%# Category %>
              <% if product.categories.any? %>
                <div class="mb-2">
                  <span class="text-xs font-semibold text-purple-600 uppercase tracking-wide">
                    <%= product.categories.first.name %>
                  </span>
                </div>
              <% end %>
              
              <%# Product Name %>
              <%= link_to product_path(product), class: "block group" do %>
                <h3 class="text-lg font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-purple-600 transition-colors">
                  <%= product.name %>
                </h3>
              <% end %>
              
              <%# Seller Info %>
              <div class="flex items-center gap-2 mb-3">
                <% if product.user.avatar&.attached? %>
                  <%= image_tag product.user.avatar.variant(resize_to_limit: [40, 40]), 
                      class: "w-6 h-6 rounded-full object-cover" %>
                <% else %>
                  <div class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-xs font-bold">
                    <%= product.user.name.first.upcase %>
                  </div>
                <% end %>
                
                <div class="flex-1 min-w-0">
                  <%= link_to product.user.name, user_path(product.user), 
                      class: "text-sm text-gray-600 hover:text-gray-900 truncate block" %>
                </div>
                
                <% if product.user.verified_seller? %>
                  <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20" title="Verified Seller">
                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                <% end %>
              </div>
              
              <%# Rating %>
              <% if product.reviews.any? %>
                <div class="flex items-center gap-2 mb-3">
                  <div class="flex items-center">
                    <% 5.times do |i| %>
                      <svg class="w-4 h-4 <%= i < product.average_rating.round ? 'text-yellow-400' : 'text-gray-300' %> fill-current" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                      </svg>
                    <% end %>
                  </div>
                  <span class="text-sm text-gray-600">
                    <%= product.average_rating.round(1) %> (<%= product.reviews.count %>)
                  </span>
                </div>
              <% end %>
              
              <%# Price and CTA %>
              <div class="flex items-end justify-between mt-4">
                <div>
                  <% if product.discount_price.present? %>
                    <div class="flex items-baseline gap-2">
                      <span class="text-2xl font-bold text-gray-900">
                        <%= number_to_currency(product.discount_price) %>
                      </span>
                      <span class="text-sm text-gray-500 line-through">
                        <%= number_to_currency(product.price) %>
                      </span>
                    </div>
                  <% else %>
                    <span class="text-2xl font-bold text-gray-900">
                      <%= number_to_currency(product.price) %>
                    </span>
                  <% end %>
                </div>
                
                <%= button_to cart_items_path(product_id: product.id), 
                    method: :post,
                    class: "action-button bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:shadow-xl hover:scale-110",
                    data: { turbo: false } do %>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      
      <%# Pagination %>
      <% if @products.respond_to?(:total_pages) && @products.total_pages > 1 %>
        <div class="mt-12 flex justify-center">
          <div class="flex items-center gap-2">
            <%= link_to_previous_page @products, 'Previous', 
                class: "btn-secondary px-6 py-2 disabled:opacity-50" %>
            
            <div class="flex items-center gap-1">
              <% (1..@products.total_pages).each do |page| %>
                <%= link_to page, products_path(page: page), 
                    class: "px-4 py-2 rounded-lg font-semibold transition-all #{page == @products.current_page ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white' : 'text-gray-700 hover:bg-gray-100'}" %>
              <% end %>
            </div>
            
            <%= link_to_next_page @products, 'Next', 
                class: "btn-secondary px-6 py-2 disabled:opacity-50" %>
          </div>
        </div>
      <% end %>
      
    <% else %>
      <%# Empty State %>
      <div class="text-center py-20">
        <svg class="w-24 h-24 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
        </svg>
        <h3 class="text-2xl font-bold text-gray-900 mb-2">No products found</h3>
        <p class="text-gray-600 mb-6">Try adjusting your search or filter to find what you're looking for.</p>
        <%= link_to "Clear Filters", products_path, class: "btn-primary" %>
      </div>
    <% end %>
  </div>
</div>

<%# Scroll to Top FAB %>
<button class="fab hidden" 
        data-controller="scroll" 
        data-scroll-target="button"
        data-action="click->scroll#toTop"
        title="Scroll to top">
  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
  </svg>
</button>